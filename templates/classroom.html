<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <div class="headerContainer">

		<h2>Classroom</h2>

	</div>
</head>
<body ondragstart="return false;" ondrop="return false;">
    <div class="container">
        <div class="left" col ="1">
            <li><a href="#home" onclick="switchToHome()">Home</a></li>
            <li><a href="#seating" onclick="switchToSeating()">Create seating</a></li>
            <li><a href="#student" onclick="switchToStudents()">Student lists</a></li>
            <li><a href="#room" onclick="switchToClassroom()">Classrooms</a></li>
            <li><a href="#about" onclick="switchToAbout()">About</a></li>
        </div>
    <div class="center" col="2">
            <div class="flex-container">
                <div class=" menu desktop-6-cols phone-12-cols">
                    <div class="grid-container grid-parent">
                        {% for x in range(10) %}
                            {% for y in range(10) %}
                                <div class="grid-item"></div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                <div class=" menu desktop-6-cols phone-12-cols">
                    <ul>
                        <li><button onclick="changeColor('white')">Clear</button></li>
                        <li><button onclick="changeColor('lightblue')">Desk</button></li>
                        <li><button onclick="changeColor('orange')">Unusable Desk</button></li>
                        <li><button onclick="changeColor('pink')">Teacher Desk</button></li>
                        <li><form>
                            <label for="filename">File name:</label><br>
                            <input type="text" id="filename" name="filename" value="classroom">
                        </form></li>
                        <li>
                            <button class="popup" onclick="sendClassroomToFlask()">Save Classroom
                            <span class="popuptext" id="Invalid">Invalid classroom!</span>
                            </button>
                        </li>
                    </ul>
                    <p id="demo"></p>
                </div>
            </div>
        </div>
    </div>
<script src="https://code.jquery.com/jquery-3.6.1.js">
    // track if mouse button is held down
    window.mouseDown = false;
    document.onmousedown = function() {
        window.mouseDown = true;
    }
    document.onmouseup = function() {
        window.mouseDown = false;
    }

    // create empty array
    var classroom = new Array(10);
    const grid_length = 10;
    const grid_height = 10;
    for (var i = 0; i < classroom.length; i++) {
        classroom[i] = new Array(10).fill(0);
    }


    const divs = document.querySelectorAll('.grid-item');
    var color = 'white';

    var x = 1;
    var y = 2;

    grid = Array.from(divs)
    grid.forEach(div => {
        div.addEventListener('mouseover', addColor);
        div.addEventListener('mousedown', addColorClick);
    });

    // assign ids to grid divs
    var grid_number = 0;
    for (let x = 0; x < grid_height; x++) {
        for (let y = 0; y < grid_length; y++) {
            grid[grid_number].setAttribute("id", x.toString() + y.toString());
            grid_number += 1;
        }
    }

    document.getElementById("demo").innerHTML = grid[99].getAttribute("id");
    console.log("test");
    function changeColor(color_arg) {
        color = color_arg;
    };

    function changeArray(array_id, color) {
        var x_val = array_id[0]
        var y_val = array_id[1]
        switch(color) {
            case "white":
                classroom[x_val][y_val] = 0;
                break;
            case "lightblue":
                classroom[x_val][y_val] = 1;
                break;
            case "orange":
                classroom[x_val][y_val] = 2;
                break;
            case "pink":
                classroom[x_val][y_val] = 3;
                break;
            default:
        }
    };

    function addColor() {
        if (window.mouseDown) {
            this.style.backgroundColor = color;
            var div_id = this.getAttribute("id");
            changeArray(div_id, color);
        }
    };

    function addColorClick() {
        this.style.backgroundColor = color;
        var div_id = this.getAttribute("id");
        changeArray(div_id, color);
    };

    function arrayToText() {
        var width = detectWidthToTrim();
        var height = detectHeightToTrim();
        var place_semi = 0;
        var text = "";

        for (let x = 0; x < grid_height; x++) {
            place_semi = 0;
            for (let y = 0; y < grid_length; y++) {
                if (width[0] <= y && y <= width[1] && height[0] <= x && x <= height[1]) {
                    text += classroom[x][y].toString();
                    place_semi = 1;
                }
            }
            if (place_semi) text += ";";
        }
        return text;
    };

    function detectWidthToTrim() {
        var start_width = 99;
        var end_width = 0;
        var found_num = 0;
        var entry = 0;

        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                entry = classroom[x][y];
                if (entry != 0 && found_num == 0) {
                    found_num = 1;
                    if (y < start_width) start_width = y;
                } else if (entry != 0) {
                    if (y > end_width) end_width = y;
      	        }
            }
        }
        return [start_width, end_width];
    };

    function detectHeightToTrim() {
        var start_height = 99;
        var end_height = 0;
        var found_num = 0;

        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                if (classroom[x][y] != 0) found_num = 1;
            }
            if (found_num == 1) {
                if (x < start_height) start_height = x;
                if (x > end_height) end_height = x;
            }
        }

        return [start_height, end_height];
    };

    // checks for a valid classroom (at least one teacher and one student desk in the room)
    function check_validity() {
        var student_found = 0;
        var teacher_found = 0;
        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                if (classroom[x][y] == 1) student_found = 1;
                if (classroom[x][y] == 3) teacher_found = 1;
            }
        }
        return student_found.toString() + teacher_found.toString();
    };

    // Function to download data to a file
    function download(filename) {
        // Also change filename to "Invalid"
        var validity = check_validity();
        switch (validity) {
            case "01":  // no student desk
                var popup = document.getElementById("Invalid");
                popup.innerHTML = "Your classroom needs at least one student desk!";
                popup.classList.toggle("show");
                return;
            case "10":  // no teacher desk
                var popup = document.getElementById("Invalid");
                popup.innerHTML = "Your classroom needs at least one teacher desk!";
                popup.classList.toggle("show");
                return;
            case "00":  // neither student nor teacher desk
                var popup = document.getElementById("Invalid");
                popup.innerHTML = "Your classroom needs at least one student and teacher desk!";
                popup.classList.toggle("show");
                return;
            default: break;
        }
        /*
        if (check_validity()) {
            var popup = document.getElementById("Invalid");
            popup.classList.toggle("show");
            return;
        }
        */
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(arrayToText()));

        read_input = document.getElementById("filename").value;
        if (read_input.length) filename = read_input + ".txt";
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    };
    /*
    function sendClassroomToFlask() {
        var userinfo = arrayToText();
        $.ajax({
            type: "POST",

        })
        const request = new XMLHttpRequest();
        request.open("POST", "/ProcessUserInfo/${JSON.stringify(userinfo)}")
        request.send();
    }*/

    function switchToClassroom() {
        window.location = "classrooms";
    }

    function switchToHome() {
        window.location = "home";
    }

    function switchToSeating() {
        window.location = "seating";
    }

    function switchToStudents() {
        window.location = "students";
    }

    function switchToAbout() {
        window.location = "about";
    }
</script>
</body>
</html>


