<!DOCTYPE html>
<html>
<head>
    <style>

    .flex-container {
        display: -webkit-flex;
        display: flex;
        -webkit-flex-wrap: wrap; /* Safari 6.1+ */
        flex-wrap: wrap;
    }

    /* Phones: */
    .phone-12-cols {width: 100%;}

    /* Desktop: */
    @media only screen and (min-width: 750px) {
        .desktop-1-cols {width: 8.33%;}
        .desktop-2-cols {width: 16.66%;}
        .desktop-3-cols {width: 25%;}
        .desktop-4-cols {width: 33.33%;}
        .desktop-5-cols {width: 41.66%;}
        .desktop-6-cols {width: 50%;}
        .desktop-7-cols {width: 58.33%;}
        .desktop-8-cols {width: 66.66%;}
        .desktop-9-cols {width: 75%;}
        .desktop-10-cols {width: 83.33%;}
        .desktop-11-cols {width: 91.66%;}
        .desktop-12-cols {width: 100%;}
    }

    .grid-container {
        display: grid;
        grid-template-columns: auto auto auto auto auto auto auto auto auto auto;
    }

    .grid-item {
        border: 1px solid rgba(0, 0, 0, 0.8);
        padding: 5px;
        font-size: 30px;
        text-align: center;
        height: 20px;
        width: 20px;
    }

    .grid-parent {
        height: 100px;
        width: 100px;
    }

    /* Popup container - can be anything you want */
    .popup {
      position: relative;
      display: inline-block;
      cursor: pointer;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* The actual popup */
    .popup .popuptext {
      visibility: hidden;
      width: 160px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -80px;
    }

    /* Popup arrow */
    .popup .popuptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    /* Toggle this class - hide and show the popup */
    .popup .show {
      visibility: visible;
      -webkit-animation: fadeIn 1s;
      animation: fadeIn 1s;
    }

    /* Add animation (fade in the popup) */
    @-webkit-keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }

    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity:1 ;}
    }

</style>
    <title>Classroom Editor</title>


</head>
<body ondragstart="return false;" ondrop="return false;">
<div class="flex-container">
    <div class=" menu desktop-6-cols phone-12-cols">
        <div class="grid-container grid-parent">
            {% for x in range(10) %}
                {% for y in range(10) %}
                    <div class="grid-item"></div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
    <div class=" menu desktop-6-cols phone-12-cols">
        <ul>
            <li><button onclick="changeColor('white')">Clear</button></li>
            <li><button onclick="changeColor('lightblue')">Table</button></li>
            <li><button onclick="changeColor('orange')">Unusable Table</button></li>
            <li><button onclick="changeColor('pink')">Teacher Table</button></li>
            <li><form>
                <label for="filename">File name:</label><br>
                <input type="text" id="filename" name="filename" value="classroom">
            </form></li>
            <li><button class="popup" onclick="download('classroom.txt')">Download Classroom
                <span class="popuptext" id="Invalid">Invalid Entry!</span>
            </button></li>
        </ul>
        <p id="demo"></p>
    </div>
</div>
<script>
    // track if mouse button is held down
    window.mouseDown = false;
    document.onmousedown = function() {
        window.mouseDown = true;
    }
    document.onmouseup = function() {
        window.mouseDown = false;
    }

    // create empty array
    var classroom = new Array(10);
    const grid_length = 10;
    const grid_height = 10;
    for (var i = 0; i < classroom.length; i++) {
        classroom[i] = new Array(10).fill(0);
    }


    const divs = document.querySelectorAll('.grid-item');
    var color = 'white';

    var x = 1;
    var y = 2;

    grid = Array.from(divs)
    grid.forEach(div => {
        div.addEventListener('mouseover', addColor);
        div.addEventListener('mousedown', addColorClick);
    });

    // assign ids to grid divs
    var grid_number = 0;
    for (let x = 0; x < grid_height; x++) {
        for (let y = 0; y < grid_length; y++) {
            grid[grid_number].setAttribute("id", x.toString() + y.toString());
            grid_number += 1;
        }
    }

    document.getElementById("demo").innerHTML = grid[99].getAttribute("id");

    function changeColor(color_arg) {
        color = color_arg;
    };

    function changeArray(array_id, color) {
        var x_val = array_id[0]
        var y_val = array_id[1]
        switch(color) {
            case "white":
                classroom[x_val][y_val] = 0;
                break;
            case "lightblue":
                classroom[x_val][y_val] = 1;
                break;
            case "orange":
                classroom[x_val][y_val] = 2;
                break;
            case "pink":
                classroom[x_val][y_val] = 3;
                break;
            default:
        }
    };

    function addColor() {
        if (window.mouseDown) {
            this.style.backgroundColor = color;
            var div_id = this.getAttribute("id");
            changeArray(div_id, color);
        }
    };

    function addColorClick() {
        this.style.backgroundColor = color;
        var div_id = this.getAttribute("id");
        changeArray(div_id, color);
    };

    function arrayToText() {
        var width = detectWidthToTrim();
        var height = detectHeightToTrim();
        var place_semi = 0;
        var text = "";

        for (let x = 0; x < grid_height; x++) {
            place_semi = 0;
            for (let y = 0; y < grid_length; y++) {
                if (width[0] <= y && y <= width[1] && height[0] <= x && x <= height[1]) {
                    text += classroom[x][y].toString();
                    place_semi = 1;
                }
            }
            if (place_semi) text += ";";
        }
        return text;
    };

    function detectWidthToTrim() {
        var start_width = 99;
        var end_width = 0;
        var found_num = 0;
        var entry = 0;

        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                entry = classroom[x][y];
                if (entry != 0 && found_num == 0) {
                    found_num = 1;
                    if (y < start_width) start_width = y;
                } else if (entry != 0) {
                    if (y > end_width) end_width = y;
      	        }
            }
        }
        return [start_width, end_width];
    };

    function detectHeightToTrim() {
        var start_height = 99;
        var end_height = 0;
        var found_num = 0;

        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                if (classroom[x][y] != 0) found_num = 1;
            }
            if (found_num == 1) {
                if (x < start_height) start_height = x;
                if (x > end_height) end_height = x;
            }
        }

        return [start_height, end_height];
    };

    function check_validity() {
        var student_found = 0;
        var teacher_found = 0;
        for (let x = 0; x < grid_height; x++) {
	        found_num = 0;
	        for (let y = 0; y < grid_length; y++) {
                if (classroom[x][y] == 1) student_found = 1;
                if (classroom[x][y] == 3) teacher_found = 1;
            }
        }
        return !(student_found && teacher_found);
    };

    // Function to download data to a file
    function download(filename) {
        // Also change filename to "Invalid"
        if (check_validity()) {
            var popup = document.getElementById("Invalid");
            popup.classList.toggle("show");
            return;
        }
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(arrayToText()));

        read_input = document.getElementById("filename").value;
        if (read_input.length) filename = read_input + ".txt";
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    };
</script>


</body>
</html>

